{% comment %}
  LUMEI - Main Product Section (Refined with Trust Elements)
{% endcomment %}

{%- style -%}
  .product-section {
    padding: 6rem 1.5rem 5rem;
  }

  .product-section__container {
    max-width: 80rem;
    margin: 0 auto;
  }

  .product-section__breadcrumb {
    margin-bottom: 2rem;
  }

  .product-section__back {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: {{ settings.color_muted }};
    font-family: 'Inter', sans-serif;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .product-section__back:hover {
    color: {{ settings.color_foreground }};
  }

  .product-section__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 4rem;
    align-items: flex-start;
  }

  @media (min-width: 1024px) {
    .product-section__grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  .product-section__gallery {
    position: relative;
  }

  .product-section__image-main {
    position: relative;
    aspect-ratio: 1;
    border-radius: 1.5rem;
    overflow: hidden;
    background: {{ settings.color_card }};
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-section__image-glow {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0.3;
    transition: opacity 0.7s ease;
  }

  .product-section__image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 2rem;
    transition: opacity 0.5s ease;
  }

  .product-section__included {
    display: none;
    margin-top: 2.5rem;
    padding: 1.5rem;
    border-radius: 1rem;
    background: {{ settings.color_card | color_modify: 'alpha', 0.5 }};
    border: 1px solid {{ settings.color_foreground | color_modify: 'alpha', 0.05 }};
  }

  @media (min-width: 1024px) {
    .product-section__included {
      display: block;
    }
  }

  .product-section__included-title {
    font-size: 0.875rem;
    color: {{ settings.color_muted }};
    font-family: 'Inter', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
  }

  .product-section__included-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .product-section__included-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.875rem;
    color: {{ settings.color_foreground | color_modify: 'alpha', 0.7 }};
    padding: 0.5rem 0;
  }

  .product-section__included-icon {
    width: 1rem;
    height: 1rem;
    color: {{ settings.color_muted }};
  }

  .product-section__info {
    position: sticky;
    top: 6rem;
  }

  .product-section__brand {
    font-size: 0.875rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: {{ settings.color_muted }};
    margin-bottom: 0.75rem;
    font-family: 'Inter', sans-serif;
  }

  .product-section__title {
    font-size: 3rem;
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    margin-bottom: 1rem;
    transition: color 0.5s ease;
  }

  @media (min-width: 640px) {
    .product-section__title {
      font-size: 3.75rem;
    }
  }

  .product-section__description {
    font-size: 1.25rem;
    color: {{ settings.color_foreground | color_modify: 'alpha', 0.8 }};
    font-family: 'Inter', sans-serif;
    font-weight: 300;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .product-section__price {
    margin-bottom: 2rem;
  }

  .product-section__price-value {
    font-size: 1.875rem;
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    color: {{ settings.color_foreground }};
  }

  .product-section__price-note {
    font-size: 0.875rem;
    color: {{ settings.color_muted }};
    margin-top: 0.25rem;
  }

  .product-section__variants {
    margin-bottom: 2rem;
  }

  .product-section__variants-label {
    font-size: 0.875rem;
    color: {{ settings.color_muted }};
    font-family: 'Inter', sans-serif;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
  }

  .product-section__variants-options {
    display: flex;
    gap: 0.75rem;
  }

  .product-section__variant-btn {
    position: relative;
    width: 3.5rem;
    height: 3.5rem;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .product-section__variant-btn:hover {
    transform: scale(1.05);
  }

  .product-section__variant-btn.is-selected {
    transform: scale(1.1);
    box-shadow: 0 0 0 2px {{ settings.color_foreground }}, 0 0 0 4px {{ settings.color_background }};
  }

  .product-section__variant-check {
    position: absolute;
    inset: 0;
    margin: auto;
    width: 1.25rem;
    height: 1.25rem;
    color: {{ settings.color_background }};
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .product-section__variant-btn.is-selected .product-section__variant-check {
    opacity: 1;
  }

  .product-section__variant-selected {
    font-size: 0.75rem;
    color: {{ settings.color_muted | color_modify: 'alpha', 0.6 }};
    margin-top: 0.75rem;
  }

  .product-section__variant-selected span {
    color: {{ settings.color_foreground | color_modify: 'alpha', 0.7 }};
  }

  .product-section__add-btn {
    width: 100%;
    margin-bottom: 0.75rem;
  }

  .product-section__secure {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: {{ settings.color_muted | color_modify: 'alpha', 0.6 }};
    margin-bottom: 2rem;
  }

  .product-section__secure-icon {
    width: 0.875rem;
    height: 0.875rem;
  }

  .product-section__trust {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
    padding: 1.5rem 0;
    border-top: 1px solid {{ settings.color_foreground | color_modify: 'alpha', 0.05 }};
    border-bottom: 1px solid {{ settings.color_foreground | color_modify: 'alpha', 0.05 }};
  }

  .product-section__trust-item {
    text-align: center;
  }

  .product-section__trust-icon {
    width: 1.25rem;
    height: 1.25rem;
    margin: 0 auto 0.5rem;
    color: {{ settings.color_muted }};
  }

  .product-section__trust-title {
    font-size: 0.75rem;
    color: {{ settings.color_foreground | color_modify: 'alpha', 0.7 }};
    font-family: 'Inter', sans-serif;
  }

  .product-section__trust-desc {
    font-size: 0.625rem;
    color: {{ settings.color_muted | color_modify: 'alpha', 0.6 }};
  }

  .product-section__payment {
    margin-bottom: 2rem;
  }

  .product-section__payment-label {
    font-size: 0.625rem;
    text-align: center;
    color: {{ settings.color_muted | color_modify: 'alpha', 0.5 }};
    margin-bottom: 0.75rem;
  }

  .product-section__payment .payment-icons {
    justify-content: center;
  }

  .product-section__guarantee {
    background: {{ settings.color_card | color_modify: 'alpha', 0.3 }};
    border: 1px solid {{ settings.color_foreground | color_modify: 'alpha', 0.03 }};
    border-radius: 0.75rem;
    padding: 1.25rem;
    margin-bottom: 2rem;
    text-align: center;
  }

  .product-section__guarantee-text {
    font-size: 0.875rem;
    color: {{ settings.color_foreground | color_modify: 'alpha', 0.7 }};
    font-family: 'Inter', sans-serif;
    line-height: 1.5;
  }

  .product-section__collapsibles {
    border-top: 1px solid {{ settings.color_foreground | color_modify: 'alpha', 0.1 }};
  }

  .product-section__collapsible {
    border-bottom: 1px solid {{ settings.color_foreground | color_modify: 'alpha', 0.1 }};
  }

  .product-section__collapsible-trigger {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 1.25rem 0;
    background: transparent;
    border: none;
    font-size: 1rem;
    font-family: 'Inter', sans-serif;
    color: {{ settings.color_foreground }};
    cursor: pointer;
    text-align: left;
  }

  .product-section__collapsible-icon {
    width: 1rem;
    height: 1rem;
    color: {{ settings.color_muted }};
    transition: transform 0.3s ease;
  }

  .product-section__collapsible[open] .product-section__collapsible-icon {
    transform: rotate(180deg);
  }

  .product-section__collapsible-content {
    padding-bottom: 1.25rem;
    font-size: 0.875rem;
    color: {{ settings.color_muted }};
    font-family: 'Inter', sans-serif;
    line-height: 1.6;
  }

  .product-section__collapsible-content p {
    margin-bottom: 0.75rem;
  }

  .product-section__collapsible-content p:last-child {
    margin-bottom: 0;
  }

  .product-section__collapsible-content strong {
    color: {{ settings.color_foreground | color_modify: 'alpha', 0.8 }};
  }

  .product-section__collapsible-content ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .product-section__collapsible-content li {
    padding: 0.25rem 0;
  }

  .product-section__collapsible-content li::before {
    content: '• ';
  }
{%- endstyle -%}

<section class="product-section">
  <div class="product-section__container">
    <nav class="product-section__breadcrumb">
      <a href="{{ routes.root_url }}" class="product-section__back">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
        Volver
      </a>
    </nav>

    <div class="product-section__grid">
      <div class="product-section__gallery">
        <div class="product-section__image-main" id="productImageMain">
          <div class="product-section__image-glow" id="productImageGlow"></div>
          {%- if product.featured_image != blank -%}
            <img 
              src="{{ product.featured_image | image_url: width: 1000 }}" 
              alt="{{ product.title }}"
              class="product-section__image"
              id="productImage"
            >
          {%- else -%}
            {{ 'product-1' | placeholder_svg_tag: 'product-section__image' }}
          {%- endif -%}
        </div>

        <!-- What's included -->
        <div class="product-section__included">
          <p class="product-section__included-title">{{ section.settings.included_title }}</p>
          <ul class="product-section__included-list">
            {%- for block in section.blocks -%}
              {%- if block.type == 'included_item' -%}
                <li class="product-section__included-item" {{ block.shopify_attributes }}>
                  <svg class="product-section__included-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"/>
                  </svg>
                  {{ block.settings.text }}
                </li>
              {%- endif -%}
            {%- endfor -%}
          </ul>
        </div>
      </div>

      <div class="product-section__info">
        <p class="product-section__brand">LUMEI</p>
        
        <h1 class="product-section__title" id="productTitle">
          {{ product.title }}
        </h1>
        
        <p class="product-section__description">
          {{ product.description | default: section.settings.default_description }}
        </p>

        <div class="product-section__price">
          <p class="product-section__price-value">{{ product.price | money }}</p>
          <p class="product-section__price-note">{{ section.settings.shipping_note }}</p>
        </div>

        {%- if product.has_only_default_variant == false -%}
          <div class="product-section__variants">
            <p class="product-section__variants-label">{{ section.settings.variants_label }}</p>
            <div class="product-section__variants-options">
              {%- for variant in product.variants -%}
                <button 
                  class="product-section__variant-btn {% if forloop.first %}is-selected{% endif %}"
                  data-variant-id="{{ variant.id }}"
                  data-variant-title="{{ variant.title }}"
                  data-variant-color="{{ variant.metafields.custom.color | default: settings.color_lamp_purple }}"
                  style="background-color: {{ variant.metafields.custom.color | default: settings.color_lamp_purple }}"
                  aria-label="Seleccionar {{ variant.title }}"
                >
                  <svg class="product-section__variant-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <polyline points="20 6 9 17 4 12"/>
                  </svg>
                </button>
              {%- endfor -%}
            </div>
            <p class="product-section__variant-selected">
              Has elegido: <span id="selectedVariantName">{{ product.selected_or_first_available_variant.title }}</span>
            </p>
          </div>
        {%- endif -%}

        <form method="post" action="/cart/add">
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="variantId">
          <button type="submit" class="button button--primary button--xl product-section__add-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <path d="M16 10a4 4 0 01-8 0"/>
            </svg>
            {{ section.settings.add_to_cart_text }}
          </button>
        </form>

        <!-- Secure checkout micro-copy -->
        <div class="product-section__secure">
          <svg class="product-section__secure-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          <span>{{ section.settings.secure_text }}</span>
        </div>

        <!-- Trust indicators -->
        <div class="product-section__trust">
          <div class="product-section__trust-item">
            <svg class="product-section__trust-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="3" width="15" height="13"/>
              <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/>
              <circle cx="5.5" cy="18.5" r="2.5"/>
              <circle cx="18.5" cy="18.5" r="2.5"/>
            </svg>
            <p class="product-section__trust-title">{{ section.settings.trust_shipping_title }}</p>
            <p class="product-section__trust-desc">{{ section.settings.trust_shipping_desc }}</p>
          </div>
          <div class="product-section__trust-item">
            <svg class="product-section__trust-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="1 4 1 10 7 10"/>
              <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
            </svg>
            <p class="product-section__trust-title">{{ section.settings.trust_returns_title }}</p>
            <p class="product-section__trust-desc">{{ section.settings.trust_returns_desc }}</p>
          </div>
          <div class="product-section__trust-item">
            <svg class="product-section__trust-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
            <p class="product-section__trust-title">{{ section.settings.trust_warranty_title }}</p>
            <p class="product-section__trust-desc">{{ section.settings.trust_warranty_desc }}</p>
          </div>
        </div>

        <!-- Payment methods -->
        <div class="product-section__payment">
          <p class="product-section__payment-label">{{ section.settings.payment_label }}</p>
          {% render 'payment-icons', opacity: 0.5 %}
        </div>

        <!-- Guarantee message -->
        <div class="product-section__guarantee">
          <p class="product-section__guarantee-text">{{ section.settings.guarantee_text }}</p>
        </div>

        <!-- Details Accordion -->
        <div class="product-section__collapsibles">
          {%- for block in section.blocks -%}
            {%- if block.type == 'collapsible_tab' -%}
              <details class="product-section__collapsible" {{ block.shopify_attributes }}>
                <summary class="product-section__collapsible-trigger">
                  {{ block.settings.heading }}
                  <svg class="product-section__collapsible-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9l6 6 6-6"/>
                  </svg>
                </summary>
                <div class="product-section__collapsible-content">
                  {{ block.settings.content }}
                </div>
              </details>
            {%- endif -%}
          {%- endfor -%}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const variantBtns = document.querySelectorAll('.product-section__variant-btn');
    const variantIdInput = document.getElementById('variantId');
    const productTitle = document.getElementById('productTitle');
    const selectedVariantName = document.getElementById('selectedVariantName');
    const productImageGlow = document.getElementById('productImageGlow');
    const productImageMain = document.getElementById('productImageMain');

    variantBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        variantBtns.forEach(b => b.classList.remove('is-selected'));
        this.classList.add('is-selected');
        
        const variantId = this.dataset.variantId;
        const variantTitle = this.dataset.variantTitle;
        const variantColor = this.dataset.variantColor;
        
        variantIdInput.value = variantId;
        if (selectedVariantName) selectedVariantName.textContent = variantTitle;
        productTitle.style.color = variantColor;
        
        productImageGlow.style.background = `radial-gradient(circle at center, ${variantColor}40, transparent 70%)`;
        productImageMain.style.boxShadow = `0 0 100px 20px ${variantColor}40`;
      });
    });

    // Initialize with first variant
    if (variantBtns.length > 0) {
      const firstColor = variantBtns[0].dataset.variantColor;
      productTitle.style.color = firstColor;
      productImageGlow.style.background = `radial-gradient(circle at center, ${firstColor}40, transparent 70%)`;
      productImageMain.style.boxShadow = `0 0 100px 20px ${firstColor}40`;
    }
  });
</script>

{% schema %}
{
  "name": "Producto LUMEI",
  "tag": "section",
  "class": "section-main-product",
  "settings": [
    {
      "type": "header",
      "content": "Textos principales"
    },
    {
      "type": "text",
      "id": "default_description",
      "label": "Descripción por defecto",
      "default": "Una luz que define tu momento, no solo tu espacio."
    },
    {
      "type": "text",
      "id": "shipping_note",
      "label": "Nota de envío",
      "default": "Envío gratuito a España peninsular"
    },
    {
      "type": "text",
      "id": "variants_label",
      "label": "Etiqueta de variantes",
      "default": "Elige tu luz"
    },
    {
      "type": "text",
      "id": "add_to_cart_text",
      "label": "Texto del botón",
      "default": "Añadir al carrito"
    },
    {
      "type": "header",
      "content": "Seguridad y confianza"
    },
    {
      "type": "text",
      "id": "secure_text",
      "label": "Texto de pago seguro",
      "default": "Pago seguro · Datos encriptados"
    },
    {
      "type": "text",
      "id": "trust_shipping_title",
      "label": "Título envío",
      "default": "Envío 24-48h"
    },
    {
      "type": "text",
      "id": "trust_shipping_desc",
      "label": "Descripción envío",
      "default": "Gratis en península"
    },
    {
      "type": "text",
      "id": "trust_returns_title",
      "label": "Título devoluciones",
      "default": "30 días"
    },
    {
      "type": "text",
      "id": "trust_returns_desc",
      "label": "Descripción devoluciones",
      "default": "Devolución fácil"
    },
    {
      "type": "text",
      "id": "trust_warranty_title",
      "label": "Título garantía",
      "default": "Garantía 2 años"
    },
    {
      "type": "text",
      "id": "trust_warranty_desc",
      "label": "Descripción garantía",
      "default": "Sin preocupaciones"
    },
    {
      "type": "text",
      "id": "payment_label",
      "label": "Etiqueta métodos de pago",
      "default": "Métodos de pago aceptados"
    },
    {
      "type": "textarea",
      "id": "guarantee_text",
      "label": "Texto de garantía",
      "default": "Si no encaja en tu espacio, puedes devolverlo. Sin preguntas."
    },
    {
      "type": "header",
      "content": "Incluido en el pedido"
    },
    {
      "type": "text",
      "id": "included_title",
      "label": "Título",
      "default": "Incluido en tu pedido"
    }
  ],
  "blocks": [
    {
      "type": "included_item",
      "name": "Artículo incluido",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Texto",
          "default": "Lámpara LUMEI"
        }
      ]
    },
    {
      "type": "collapsible_tab",
      "name": "Pestaña colapsable",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Título",
          "default": "Especificaciones"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Contenido"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Producto LUMEI",
      "blocks": [
        {
          "type": "included_item",
          "settings": { "text": "Lámpara LUMEI" }
        },
        {
          "type": "included_item",
          "settings": { "text": "Cable USB-C de 2 metros" }
        },
        {
          "type": "included_item",
          "settings": { "text": "Guía de cuidado del cristal" }
        },
        {
          "type": "included_item",
          "settings": { "text": "Caja de presentación premium" }
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Especificaciones",
            "content": "<ul><li>Dimensiones: 28cm x 12cm x 12cm</li><li>Material: Cristal de amatista natural</li><li>LED de bajo consumo incluido</li><li>Cable USB-C de 2m</li><li>3 modos de luz ajustables</li><li>Peso: aproximadamente 1.2kg</li></ul>"
          }
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Envío y entrega",
            "content": "<p><strong>España peninsular:</strong> Envío gratuito. Entrega en 24-48h laborables.</p><p><strong>Baleares y Canarias:</strong> Coste calculado al finalizar. Entrega en 3-5 días.</p><p><strong>Portugal:</strong> Desde 5€. Entrega en 2-4 días.</p>"
          }
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Devoluciones y garantía",
            "content": "<p><strong>30 días para devolver:</strong> Si no es lo que esperabas, contacta con nosotros. Te gestionamos la recogida sin coste adicional.</p><p><strong>Garantía de 2 años:</strong> Cubre defectos de fabricación. El cristal natural puede tener variaciones únicas que no se consideran defectos.</p>"
          }
        },
        {
          "type": "collapsible_tab",
          "settings": {
            "heading": "Cuidado del producto",
            "content": "<p>Limpia suavemente con un paño seco. Evita productos químicos. El cristal de amatista es natural y cada pieza es única en forma y tonalidad.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}